
mixin romtable(allRoms)
  div.table-responsive
    table.table.table-striped.table-hover#rom-table
      thead
        tr
          th.col-device Device
          th.col-updatechannel Type
          th.col-filename Filename / Download
          th.col-size Size
          th.col-date Build date
      tbody
        each rom in allRoms
          tr
            - var deviceArticle = contents.devices[rom.DeviceId + '.json']
            - var deviceName = deviceArticle.metadata.name
            td
              a(href="#{deviceArticle.url}", title="Click to show all roms for #{deviceName}")
                |  #{deviceName}
              if deviceArticle.metadata.displayName
                br
                small #{deviceArticle.metadata.displayName}
            td #{rom.updateChannel}
            td
              dl.dl-horizontal
                dt
                  b Download:
                dd
                  a.btn.btn-default.btn-xs(href="#{rom.downloadUrl}", rel="nofollow", title="Click to download #{rom.filename}")
                    span.glyphicon.glyphicon-download
                    |  #{rom.filename}
                if rom.subdirectory
                  dt
                    small directory:
                  dd
                    small #{rom.subdirectory}
                dt
                  small md5sum:
                dd
                  small
                    - var md5DownloadContent = new Buffer(rom.md5sum + "  " + rom.filename).toString('base64')
                    - var downloadMd5InBrowser = 'data:application/octet-stream;base64,' + md5DownloadContent
                    - var md5sumDownloadFilename = rom.filename + '.md5sum'
                    a(href=downloadMd5InBrowser, download=md5sumDownloadFilename, title="Click to download the md5sum file for #{rom.filename}")
                      | #{rom.md5sum}
            td(data-order=rom.fileSize)
              if rom.fileSize
                | #{filesize(rom.fileSize)}
              else
                i (unknown)
            - var romTimestamp = new Date(rom.timestamp)
            td(data-order=romTimestamp.toISOString())
              | #{romTimestamp.toUTCString()}
